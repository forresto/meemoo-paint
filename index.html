<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>Canvas Playground</title>
<style>
canvas { border: dotted 1px #999; width: 80%; height: 80%; margin: 0 auto; display: block; }
#controls { width: 80%; margin: 10px auto;}
.tools { float: left; }
.actions { float: right; }
a { cursor: pointer; }
a.toggler { padding: 0 5px; }
a.toggler.on { background: black; color: white; }
</style>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script>
$(function () {
    var $canvas    = $('canvas'),
        $coords    = $('#coords'),
        off        = $canvas.offset(),
        $lockables = $('.toggler');
        
    // make toggle items behave like radio buttons
    $('.toggler').click(function () {
        if (!$(this).is('.locked')) {
            var cur = this;
            $('.toggler').each(function () {
                $(this).toggleClass('on', this == cur);
            });
        }
        return false;
    });

    // clear out the canvas
    $('#clear').click(function () {
        clearCanvas();
        return false;
    });
    
    // track mouse movements
    $canvas
    
        // give the canvas HTML attributes to ensure 1px = 1 canvas unit
        .attr('width', $canvas.outerWidth())
        .attr('height', $canvas.outerHeight())
        
        // track mouse movements to update coordinates and handle drawing, if 
        // needed
        .each(function () {
            var start, drawing, tool;
            $(this)
                .bind('mousemove', function (e) {
                    var x = e.pageX - off.left,
                        y = e.pageY - off.top;
                    $coords.text(x + ', ' + y);
                    if (drawing) {
                        if ('line' === tool) {
                            clearCanvas();
                            drawing.beginPath();
                            drawing.moveTo(start.x, start.y);
                            drawing.lineTo(x, y);
                        }
                        // else {
                        //     context.fillRect(
                        //         start.x, start.y, x - start.x, y - start.y
                        //     );
                        // }
                        drawing.strokeStyle = "#999";
                        drawing.stroke();
                    }
                })
                .click(function (e) {
                    var x = e.pageX - off.left,
                        y = e.pageY - off.top;
                        
                    // which tool was active when we started drawing?
                    tool = $('.toggler.on:first').attr('id');
                    
                    // if haven't started, create a drawing context and record 
                    // our starting point
                    if (!drawing) {
                        $lockables.addClass('locked');
                        drawing = $(this)[0].getContext('2d');
                        start = {x: x, y: y};
                    }
                    
                    // if we are stopping drawing, get rid of the context
                    else {
                        clearCanvas();
                        drawing.beginPath();
                        drawing.moveTo(start.x, start.y);
                        drawing.lineTo(x, y);
                        drawing.strokeStyle = '#000';
                        drawing.stroke();
                        $lockables.removeClass('locked');
                        drawing = last = null;
                    }
                    
                    return false;
                });
        });
    
    function clearCanvas() {
        $canvas[0].width = $canvas[0].width;
    }
});
</script>
</head>
<body>
<canvas></canvas>
<div id="controls">
<div id="coords"></div>
<div class="tools">
    <a id="line" class="toggler on">line</a>
    <a id="rect" class="toggler">rect</a>
</div>
<div class="actions">
    <button id="clear">Clear</button>
</div>
</div>
</body>
</html>